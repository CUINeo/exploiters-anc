#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <cpuid/cache.h>
#include <cpuid/cpuid.h>

#include "args.h"

#include "intel/cache.h"

size_t copy_cache_desc(union cache_desc *cache_descs, size_t size,
	union cache_desc *cache_desc)
{
	if (cache_descs && size) {
		memcpy(cache_descs, cache_desc, sizeof *cache_desc);
	}

	return 1;
}

size_t set_tlb_desc(union cache_desc *cache_descs, size_t size,
	unsigned flags, size_t nways, size_t nentries, size_t page_size)
{
	if (cache_descs && size) {
		cache_descs->tlb.flags = flags;
		cache_descs->tlb.nways = nways;
		cache_descs->tlb.nentries = nentries;
		cache_descs->tlb.page_size = page_size;
	}

	return 1;
}

size_t get_cache_descs(union cache_desc *cache_desc, size_t size)
{
	size_t n = 0;

	switch (cpuid_get_vendor_id()) {
	case CPUID_VENDOR_INTEL:
		return intel_get_cache_descs(cache_desc + n, size - min(size, n));
	default:
		return 0;
	}
}
